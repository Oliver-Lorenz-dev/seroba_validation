#!/bin/bash

echo "Commencing test suite..."
echo
echo "Installing python dependencies..."
echo

# check for python3 executable
which python3 > /dev/null || { echo "python3 executable not found, cannot run tests!"; exit 1; }

python3 -m venv venv
source venv/bin/activate
pip install bio

echo
echo "Python dependencies installed successfully, proceeding to test..."
echo
sleep 1

for f in */run_test.sh
do
  serotype=$(echo $f | awk -F "/" '{ print $1 }')
  echo "Running test for ${serotype}..."
  sleep 1
  bash $f || exit 1
  echo "Test passed for ${serotype}!"
  echo
  echo
  echo
  echo
  echo
  sleep 1
done

rm -r venv


echo "     Test passed!
⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⡾⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⣸⡏⠀⡈⢿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⢀⣿⠀⣸⡇⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⡶⢶
⠀⠀⠀⠀⠀⠀⠀⣼⡇⢰⡿⠀⢀⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⡾⠉⡀⣾
⠀⠀⠀⠀⠀⠀⣰⡟⢠⣿⠿⠁⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⡾⠋⣠⠞⢷⡏
⠀⠀⠀⠀⠀⣴⡟⢁⣾⣿⡭⠀⣼⠃⠀⠀⠀⠀⠀⠀⣀⡴⠛⠁⣠⣾⠋⠀⣾⠃
⠀⠀⠀⢀⣾⠟⠀⣼⣿⣿⠃⢰⡟⠀⠀⠀⠀⠀⣠⡾⠋⠀⢀⣾⣿⠃⢀⣾⠏⠀
⠀⠀⠀⣼⡿⠀⢰⣿⡿⠁⢠⡟⠀⠀⠀⠀⠀⣼⡟⠁⠀⣴⣿⠿⢀⣴⣿⠋⠀⠀
⠀⠀⠀⣿⠇⠀⣾⡟⠁⣰⡟⠀⠀⠀⠀⠀⣸⡟⠀⠀⣼⣿⠉⣴⣿⠟⠁⠀⠀⠀
⠀⠀⠀⣿⡀⠀⣿⡇⢰⡿⠀⠀⠀⠀⠀⠀⣿⠃⠀⣸⡿⢁⣾⠟⠁⠀⠀⠀⠀⠀
⠀⠀⠀⢻⣇⠀⢿⡇⢸⡇⠀⠀⠀⠀⠀⠀⣿⠀⢠⡟⢠⣿⠋⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠈⣿⡀⠸⡇⣿⢄⡀⣀⣀⣀⣀⣰⣿⡄⣼⢁⣾⠃⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠘⣷⠀⣷⢿⠿⡿⡟⡿⢟⠉⢉⣿⣿⡟⢸⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⣿⡀⠸⢸⣷⣴⣤⣤⣾⣶⣈⢙⡿⠃⡟⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⢸⡇⠀⠘⠇⡹⠟⠋⠉⠉⠉⠻⡀⠰⣧⣄⣀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⣸⠇⠀⠀⠀⣠⡶⠟⠛⠛⠛⠀⠀⠀⣀⣭⣝⣷⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⣿⠀⠀⠀⠀⢉⠔⣊⣁⠂⠀⠀⢀⡾⢆⠈⢹⡿⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⣰⠟⠀⠀⠀⠀⢀⡾⢱⡤⢹⠀⠀⢸⣟⣲⢡⡏⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⣠⠟⠀⠀⠀⠀⠀⢈⠑⠒⠒⠋⠀⠀⠘⣯⡎⢾⡀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⢀⣴⠋⠀⠀⠀⠀⠀⠀⠀⠙⠛⠉⢀⠀⠠⠤⠼⢷⣄⠹⣄⠀⠀⠀⠀⠀⠀⠀
⢠⡾⠃⠀⠀⠀⠀⠀⠀⠀⠀⢀⡠⠖⠁⠀⠀⠀⠀⠀⠈⠙⠻⣄⠀⠀⠀⠀⠀⠀
⣼⡇⠀⠀⠀⠀⢰⠃⡾⢋⠑⠀⠀⠀⠀⠀⠀⡀⠀⠀⠀⠀⠀⠈⢷⣄⠀⠀⠀⠀
⣿⡇⠀⠀⠀⠀⡏⠀⠀⢹⡇⠀⠀⠀⠀⠀⠀⢿⣄⡀⠀⠀⠀⠀⠀⢻⡄⠀⠀⠀
⢹⡇⢠⠀⠀⠀⠁⠀⠀⢸⣇⠀⠀⠀⠀⠀⠈⠒⠉⠁⠀⠀⠀⠀⠀⠀⡇⠀⠀⠀
⠈⢿⡌⢷⣤⠀⠀⠀⠀⢸⣿⣆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⡇⠀⠀⠀
⠀⠘⢷⣦⠙⠷⣄⠀⠀⠸⣏⠙⣮⡢⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⠇⠀⠀⠀
⠀⠀⠀⠙⠷⠶⣦⣀⣠⠀⢹⡷⢌⡻⣦⣁⠀⠀⠀⠀⠀⠀⠀⢤⣶⠟⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠈⠙⠿⣧⡀⠻⣎⣁⡀⢉⠙⠒⠶⠶⠶⣲⡞⠉⠁⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⢷⡄⢈⠻⢷⣤⣀⣁⣀⣛⡻⢹⠇⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣷⠀⠁⠀⠉⣉⣉⣉⣉⡴⠏⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠛⠷⠦⣤⣤⠴⠟⠋⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀"
